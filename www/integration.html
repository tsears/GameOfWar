---
layout: main
---

<script src="/js/War.js"></script>
<script src="/js/lib/nglib.js"></script>

<style>
  #integration-container {
    display: flex;
    justify-content: space-between;
  }

  #integration-container > div {
    margin: 1em;
  }

  .card-display {
    display: flex;
    justify-content: center;
    margin: 0;
  }

  .panel div {
    margin: 0;
    padding: 0.1em 0.5em;
    margin-bottom: 0.2em;
  }
</style>

<h1>Integration Demo</h1>

<p>This page serves as a integration spot-check</p>

{% raw %}
<div ng-app='IntegrationApp' ng-controller='IntegrationController as vm'>
 <div id="integration-container">
   <div>
     <h2>Ordered Deck</h2>
     <div class="panel">
       <div ng-repeat="card in vm.orderedDeck" class="card-display">
         <div>Suit: {{card.suit}}</div>
         <div>Rank: {{card.rank}}</div>
       </div>
     </div>
   </div>
   <div>
     <h2>Shuffled Deck</h2>
     <div class="panel">
       <div ng-repeat="card in vm.shuffledDeck" class="card-display">
         <div>Suit: {{card.suit}}</div>
         <div>Rank: {{card.rank}}</div>
       </div>
     </div>
   </div>
   <div>
     <h2>Sample Rounds</h2>
     <div ng-repeat="round in vm.results" class="round-outcome panel">
       <result result="::round"></result>
     </div>
   </div>
   <div>
     <h2>Sample Wars</h2>
     <div class="panel">
       <div><strong>Sample War</strong></div>
       <hr/>
       <result result="::vm.sampleWarResult"></result>
     </div>

     <div class="panel">
       <div><strong>Sample Double+ War</strong></div>
       <hr/>
       <result result="::vm.sampleDoubleWarResult"></result>
     </div>

     <div class="panel">
       <div><strong>Sample Three Way+ War</strong></div>
       <hr/>
       <result result="::vm.sampleThreeWayWarResult"></result>
     </div>
   </div>
 </div>
</div>
{% endraw %}
<script>


var app = angular.module('IntegrationApp', []);

app.directive('result', function() {
  return {
		restrict: 'E',
		replace: 'true',
    controller: [ function() {} ],
    controllerAs: "rvm",
    scope: {},
    templateUrl: "/ng-templates/result.html",
    bindToController: {
      result: '<'
    },
	};
})

app.controller('IntegrationController', [function() {
  var emptyDeck = function(deck) {
    var out = [];

    for (var i = 0; i < deck.initialSize; i++) {
      out.push(deck.deal());
    }

    return out;
  }

  this.orderedDeck = emptyDeck(new War.Deck(4,4));

  // todo - decks should be immutable...
  var x = new War.Deck(4,4);
  x.shuffle();
  this.shuffledDeck = emptyDeck(x);

  var normalDeck = new War.Deck(4, 13);
  normalDeck.shuffle();
  var game = new War.Game(normalDeck, 4);

  this.results = [];
  this.results.push(game.playRound());
  this.results.push(game.playRound());
  this.results.push(game.playRound());
  this.results.push(game.playRound());

  var startWar = function(filter) {
    var deck = new War.Deck(4, 13);
    deck.shuffle();
    var game = new War.Game(deck, 4);

    while (true) {
      var outcome = game.playRound();
      if (filter(outcome)) {
        deck = new War.Deck(4, 13);
        deck.shuffle();
        game = new War.Game(deck, 4);
      } else {
        return outcome;
      }
    }
  }

  // A war...
  this.sampleWarResult = startWar(function(o) { return !o.war });
  this.sampleDoubleWarResult = startWar(function(o) { return !o.draws.some(d => d.length === 3)})
  this.sampleThreeWayWarResult = startWar(function(o) { return o.draws.filter(d => d.length > 1).length < 3; })
}]);

</script>
